write_files:
  - content: ${reset-iptables}
    encoding: base64
    path: /root/init/reset-iptables.sh
    permissions: '0777'
  - content: ${install-kubeadm}
    encoding: base64
    path: /root/init/install-kubeadm.sh
    permissions: '0777'

package_update: true
package_upgrade: true
package_reboot_if_required: true

runcmd:
  - echo 'Running leader cloud-init script'
  - /root/init/reset-iptables.sh
  - /root/init/install-kubeadm.sh
  - echo 'Leader cloud-init script complete'
  - echo 'It is a leader instance, which was provisioned by Terraform' >> /etc/motd
