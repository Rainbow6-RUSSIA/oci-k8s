write_files:
  - content: ${base64encode(reset-iptables)}
    encoding: base64
    path: /root/init/reset-iptables.sh
    permissions: '0777'
  - content: ${base64encode(install-kubeadm)}
    encoding: base64
    path: /root/init/install-kubeadm.sh
    permissions: '0777'
  - content: ${base64encode(setup-worker)}
    encoding: base64
    path: /root/init/setup-worker.sh
    permissions: '0777'

package_update: true
package_upgrade: true
package_reboot_if_required: true

runcmd:
  - echo 'Running worker cloud-init script'
  - /root/init/reset-iptables.sh
  - /root/init/install-kubeadm.sh
  - /root/init/setup-worker.sh
  - echo 'Worker cloud-init script complete'
  - echo 'This is a worker instance, which was provisioned by Terraform' >> /etc/motd
